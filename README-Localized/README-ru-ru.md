# Использование службы Auth0 в надстройках Office для упрощения входа через социальные сети

Служба Auth0 упрощает процесс входа через социальные сети с помощью таких веб-служб как Facebook, Google и Майкрософт. В этом примере показано, как пользоваться службой Auth0 в надстройке Office. 

## Содержание
* [История изменений](#История-изменений)
* [Необходимые компоненты](#Необходимые-компоненты)
* [Настройка проекта](#Настройка-проекта)
* [Создание учетной записи Auth0 и ее настройка на использование учетной записи Google, Facebook или Майкрософт](#Создание-учетной-записи-auth0-и-ее-настройка-на-использование-учетной-записи-google-facebook-или-майкрософт)
* [Добавление значений учетной записи Auth0 в пример кода](#Добавление-значений-учетной-записи-auth0-в-пример-кода)
* [Развертывание надстройки](#Развертывание-надстройки)
* [Запуск проекта](#Запуск-проекта)
* [Запуск надстройки](#Запуск-надстройки)
* [Тестирование надстройки](#Тестирование-надстройки)
* [Вопросы и комментарии](#Вопросы-и-комментарии)
* [Дополнительные ресурсы](#Дополнительные-ресурсы)

## История изменений

6 сентября 2016 г.

* Исходная версия.

## Необходимые компоненты

* Учетная запись с [Auth0](https://auth0.com)
* Word 2016 для Windows, сборка 16.0.6727.1000 или более поздней версии.
* [Node и npm.](https://nodejs.org/en/) В этом проекте npm используется как диспетчер пакетов и как средство запуска приложений. В качестве веб-сервера используется Lite Server. Надстройка размещается на нем во время разработки, чтобы ее можно было быстро настроить и запустить. Вы можете использовать другое средство запуска задач или другой веб-сервер.
* [Git Bash](https://git-scm.com/downloads) (или другой клиент git).

## Настройка проекта

В папке проекта выполните следующие команды в консоли git bash:

1. ```git clone {URL of this repo}```, чтобы клонировать этот репозиторий на локальный компьютер.
2. ```npm install```, чтобы установить все детализированные зависимости в файл package.json.
3. ```bash gen-cert.sh```, чтобы создать сертификат, необходимый для запуска этого примера. 

Сделайте сертификат доверенным корневым центром. Для этого на компьютере с Windows выполните указанные ниже действия.

1. В папке репозитория на локальном компьютере дважды щелкните файл ca.crt и выберите элемент **Установить сертификат**. 
2. Выберите **Локальный компьютер** и нажмите кнопку **Далее**, чтобы продолжить. 
3. Выберите **Поместить все сертификаты в следующее хранилище** и нажмите кнопку **Обзор**.
4. Выберите **Доверенные корневые центры сертификации** и нажмите кнопку **ОК**. 
5. Выберите **Далее**, а затем **Готово**. 

## Создание учетной записи Auth0 и ее настройка на использование учетной записи Google, Facebook или Майкрософт

Уже после публикации этого файла сведений у службы Auth0 может измениться пользовательский интерфейс и терминология. Поэтому мы старались избегать ссылок на элементы пользовательского интерфейса. В случае необходимости можно использовать эти инструкции, чтобы понять суть того, что нужно сделать, прежде чем обратиться к справке Auth0.

1. Создайте учетную запись в информационной панели Auth0 (можно использовать существующую учетную запись). Вам будет предложено выбрать имя учетной записи. Оно также станет поддоменом auth0.com, с которым будет взаимодействовать надстройка (например, `officeaddin.auth0.com`). Запишите это имя.
2. При появлении запроса выберите нужных поставщиков: Facebook, Google и учетную запись Майкрософт. В этом примере используются только эти поставщики, поэтому отключите остальных (которые могут быть включены по умолчанию), а также параметр **База данных** (или **Проверка подлинности с использованием имени пользователя и пароля**).  Вы можете изменить этот параметр позже, если захотите распространить действие примера на других поставщиков.
3. Auth0 создаст в учетной записи **приложение по умолчанию** (также называемое **Клиент**). Перейдите на страницу **Параметры** этого приложения.
4. Запишите идентификатор клиента, он понадобится в дальнейшем.
5. В поле **Тип клиента** выберите **Одностраничное приложение**. 
6. В поле **Разрешенные обратные вызовы** введите `https://localhost:3000/popupRedirect.html`.
7. Для всех остальных параметров оставьте значения по умолчанию и нажмите кнопку **Сохранить изменения**.

## Добавление значений учетной записи Auth0 в пример кода

1. Откройте файл index.js и найдите вверху следующие строки:
```
Auth0AccountData.subdomain = '{Auth0 account subdomain}';
Auth0AccountData.clientID = '{Auth0 client ID}';
```
2. Замените заполнители на нужные строки, записанные вами во время предыдущей процедуры.

## Развертывание надстройки

Теперь необходимо сообщить Microsoft Word, где находится эта надстройка.

1. Создайте сетевую папку или [предоставьте общий доступ к папке](https://technet.microsoft.com/en-us/library/cc770880.aspx).
2. Поместите копию файла манифеста Office-Add-in-Auth0.xml из корня проекта в общую папку.
3. Запустите Word и откройте документ.
4. Перейдите на вкладку **Файл**, а затем выберите **Параметры**.
5. Выберите **Центр управления безопасностью**, а затем нажмите кнопку **Параметры центра управления безопасностью**.
6. Выберите пункт **Доверенные каталоги приложений**.
7. В поле **URL-адрес каталога** введите сетевой путь к общей папке с файлом Office-Add-in-Auth0.xml и выберите **Добавить каталог**.
8. Установите флажок **Показать в меню** и нажмите кнопку **ОК**.
9. Появится сообщение, информирующее о том, что параметры будут применены при следующем запуске Microsoft Office. Закройте Word.

## Запуск проекта

1. Откройте командное окно узла в папке проекта и запустите ```npm start``` для запуска веб-службы. Не закрывайте командное окно.
2. Откройте Internet Explorer или Edge и введите ```https://localhost:3000``` в адресной строке. Если вы не получите никаких предупреждений о сертификате, закройте браузер и перейдите к приведенному ниже разделу под названием **Запуск надстройки**. Если вы получите предупреждение, что сертификат не является доверенным, выполните указанные ниже действия.
3. Несмотря на предупреждение в браузере отобразится ссылка на открытие страницы. Откройте ее.
4. После открытия страницы в адресной строке появится оповещение об ошибке сертификата красного цвета. Дважды щелкните это оповещение.
5. Выберите элемент **Просмотр сертификата**.
5. Нажмите **Установить сертификат**.
4. Выберите **Локальный компьютер** и нажмите кнопку **Далее**, чтобы продолжить. 
3. Выберите **Поместить все сертификаты в следующее хранилище** и нажмите кнопку **Обзор**.
4. Выберите **Доверенные корневые центры сертификации** и нажмите кнопку **ОК**. 
5. Выберите **Далее**, а затем **Готово**.
6. Закройте браузер.

## Запуск надстройки

1. Перезапустите Word и откройте документ Word.
2. На вкладке **Вставка** в Word 2016 выберите **Мои надстройки**.
3. Перейдите на вкладку **Общая папка**.
4. Выберите **Аутентификация с помощью Auth0**, а затем нажмите **ОК**.
5. Если ваша версия Word поддерживает команды надстроек, то в пользовательском интерфейсе отобразятся сведения о том, что надстройка загружена.
6. На вкладке "Главная" отобразится новая группа под названием **Auth0** с кнопкой **Показать** и значком. Нажмите эту кнопку, чтобы открыть надстройку.

 > Примечание. Если ваша версия Word не поддерживает команды надстроек, то надстройка загрузится в области задач.

## Тестирование надстройки

1. При запуске надстройки откроется страница приветствия. Нажмите кнопку **Войти**.
2. Откроется всплывающее окно, в котором вам будет предложено выбрать поставщика удостоверений. Нажмите одну из кнопок. 
3. Если вы еще не вошли в систему с помощью этого поставщика, откроется страница входа поставщика. (После первого входа вам будет предложено предоставить службе Auth0 разрешение на доступ к вашему профилю.) После входа диалоговое окно закроется, а в области задач отобразится главная рабочая страница надстройки. (Если вы уже вошли в систему с помощью поставщика, диалоговое окно закроется сразу после нажатия кнопки поставщика.)
4. Нажмите кнопку **Вставить имя пользователя**. Это вставит ваше имя пользователя в документ Word.

## Вопросы и комментарии

Мы будем рады узнать ваше мнение об этом примере. Своими мыслями можете поделиться на вкладке *Issues* (Проблемы) этого репозитория.

Общие вопросы о разработке решений для Microsoft Office 365 следует задавать на сайте [Stack Overflow](http://stackoverflow.com/questions/tagged/office-js+API). Если ваш вопрос касается API JavaScript для Office, добавьте к нему теги [office-js] и [API].

## Дополнительные ресурсы

* [Документация по надстройкам Office](https://msdn.microsoft.com/en-us/library/office/jj220060.aspx)
* [Центр разработки для Office](http://dev.office.com/)
* Другие примеры надстроек Office см. на странице [OfficeDev на Github](https://github.com/officedev).

## Авторское право
© Корпорация Майкрософт (Microsoft Corporation), 2016 г. Все права защищены.

